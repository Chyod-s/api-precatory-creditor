{% extends "layouts/base.html" %}

{% block title %}Login - Mercatório{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-6 rounded-md shadow-md text-black">
    <h2 class="text-2xl font-bold mb-4 flex items-center justify-center">Login</h2>
    <form id="login-form">
        <div class="mb-4">  
            <label for="username" class="block text-gray-700">Usuário:</label>
            <input type="text" id="username" name="username" class="w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
            <label for="password" class="block text-gray-700">Senha:</label>
            <input type="password" id="password" name="password" class="w-full p-2 border rounded" required>
        </div>
        <button type="submit" class="w-full p-2 bg-blue-500 text-white rounded">Entrar</button>
    </form>
    <p id="message" class="mt-4 text-center text-red-600"></p>
</div>

<script>
document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = e.target.username.value;
    const password = e.target.password.value;

    const query = new URLSearchParams({ username, password }).toString();

    const res = await fetch(`/usuarios?${query}`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' }
    });

    const data = await res.json();

    const msgEl = document.getElementById('message');
    if (res.ok) {
        msgEl.style.color = 'green';
        msgEl.textContent = data.message;
        setTimeout(() => { window.location.href = '/dashboard'; }, 1000);
    } else {
        msgEl.style.color = 'red';
        msgEl.textContent = data.message;
    }
});
</script>
{% endblock %}
